# Completions
fpath=("$HOME/.oh-my-zsh/custom/completions" $fpath)
autoload -Uz compinit
compinit

# Path to your oh-my-zsh installation.
export ZSH="$HOME/.oh-my-zsh"

# Random theme on each shell
ZSH_THEME="random"

# Pasting URLs fix
DISABLE_MAGIC_FUNCTIONS="true"

# Command auto-correction
ENABLE_CORRECTION="true"

# Timestamp format in history
HIST_STAMPS="yyyy-mm-dd"

# oh-my-zsh custom directory (aliases.zsh, path.zsh auto-sourced)
ZSH_CUSTOM="$HOME/.config/zsh"

# Plugins
plugins=(git)

source $ZSH/oh-my-zsh.sh

# ── User Configuration ───────────────────────────────────────────────

# Locale
export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8

# ── PATH ─────────────────────────────────────────────────────────────

export PATH="$HOME/.local/bin:$PATH"
export PATH="$HOME/.bun/bin:$PATH"

{{ if eq .chezmoi.os "darwin" -}}
# macOS-specific PATH additions
[ -d "$HOME/.codeium/windsurf/bin" ] && export PATH="$HOME/.codeium/windsurf/bin:$PATH"
[ -d "$HOME/.lmstudio/bin" ] && export PATH="$PATH:$HOME/.lmstudio/bin"
[ -d "$HOME/.antigravity/antigravity/bin" ] && export PATH="$HOME/.antigravity/antigravity/bin:$PATH"
[ -d "$HOME/.android-dev" ] && export PATH="$HOME/.android-dev:$PATH"
{{ end -}}

# ── Tools ────────────────────────────────────────────────────────────

# Zoxide (smart cd)
eval "$(zoxide init zsh)"

# fzf (fuzzy finder)
source <(fzf --zsh)

# oh-my-posh prompt (skip Apple Terminal)
if [ "$TERM_PROGRAM" != "Apple_Terminal" ]; then
  eval "$(oh-my-posh init zsh --config catppuccin)"
fi

# mise (runtime version manager)
eval "$(mise activate zsh)"

{{ if eq .chezmoi.os "darwin" -}}
# Google Cloud SDK (macOS / Homebrew)
[ -f '/opt/homebrew/share/google-cloud-sdk/path.zsh.inc' ] && . '/opt/homebrew/share/google-cloud-sdk/path.zsh.inc'
[ -f '/opt/homebrew/share/google-cloud-sdk/completion.zsh.inc' ] && . '/opt/homebrew/share/google-cloud-sdk/completion.zsh.inc'

# Kiro shell integration
[[ "$TERM_PROGRAM" == "kiro" ]] && . "$(kiro --locate-shell-integration-path zsh)"
{{ end -}}

# AsyncAPI CLI Autocomplete
ASYNCAPI_AC_ZSH_SETUP_PATH="$HOME/Library/Caches/@asyncapi/cli/autocomplete/zsh_setup"
[ -f "$ASYNCAPI_AC_ZSH_SETUP_PATH" ] && source "$ASYNCAPI_AC_ZSH_SETUP_PATH"

# OpenClaw Completion
command -v openclaw &>/dev/null && source <(openclaw completion --shell zsh)
